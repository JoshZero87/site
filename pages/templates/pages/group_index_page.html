{% extends "pages/base_page.html" %}

{% load static wagtailcore_tags %}

{% block content %}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css"
  integrity="sha512-M2wvCLH6DSRazYeZRIm1JnYyh22purTM+FDB5CsyxtQJYeKq83arPe5wgbNmcFXGqiSH2XR8dT/fJISVA1r/zQ=="
  crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"
  integrity="sha512-lInM/apFSqyy1o6s89K4iQUKg6ppXEgsVxT35HbzUupEVRh2Eu9Wdl4tHj7dZO0s1uvplcYGmt3498TtHq+log=="
  crossorigin=""></script>
<!-- <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css" />
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css" />
<script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script> -->
  

<div class="container groups-map">
  <div class="row">
    <div class="groups-map-info">
      <div class="groups-map__intro pa20 blue-bg action-bg white-text">
        <h3 class="mt0 mb0 groups-map__heading">Local Groups <span class="glyphicon glyphicon-chevron-down"></h3>
        <p>Our Revolution is made up of local groups from all around the world. Search for a group to get involved with in your area today.</p>
      </div>
      <div class="groups-map-info__search">
        <!-- <Label for="autocomplete-input" class="uppercase ls2">Search for a group</label> -->
        <input type="search" class="form-control maps-auto-complete" placeholder="Postal Code, City, or Address" id="autocomplete-input">
      </div>

      <div class="groups-map-info__status text-left">
        <div class="component pa20 hidden-xs">
          <div class="groups-map__add">
            <h4 class="mb20 mt0">No group in your area?</h4>
            <a href="https://docs.google.com/document/d/1BWp6HCZ6tngr6SJHJB3H1uPTX2Hcv6cMUQondCrBkHg/edit" class="btn btn-block btn-primary uppercase ls2" target="_blank" onclick="trackOutboundLink('https://docs.google.com/document/d/1BWp6HCZ6tngr6SJHJB3H1uPTX2Hcv6cMUQondCrBkHg/edit', true)">Start a group</a>
            <a href="/groups/new" class="btn btn-block btn-secondary uppercase ls2">Add your group</a>

            <!-- <p class="mt20"><small>We're currently experiencing a high number of group applications, which may lead to delays in adding your group to the map.</small></p> -->
          </div>
        </div>
      </div>
    </div>

    <div class="groups-map__map light-wash" id="map-container"></div>
  </div>
</div>

<div class="container pt4 pb2">
  <div class="row">
    <div class="col-xs-12">
      <h3>
        In addition to Local Groups, you can also take action on national
        Our Revolution campaigns.
      </h3>
    </div>
  </div>
</div>
{% include "partials/take_action_content.html" %}

<script>
  var mapDiv = document.getElementById('map-container'),
    inputDiv = document.getElementById('autocomplete-input');
  Groups.init(mapDiv);
  Groups.monitorAPI(inputDiv);

  var data = {{groups|safe}}

  for(i=0; i<data.features.length; i++) {
    if(data.features[i].properties.status == 'approved'){

      Groups.addGroup(data.features[i]);
    }
  }

  $('#autocomplete-input').on('keyup', function(e) {
    if(e.target.value.length > 0) {
      $('.groups-map-info__search').addClass('active');
    } else {
      $('.groups-map-info__search').removeClass('active');
    }
  });

  $('.groups-map__heading .glyphicon').on('click touchstart', function(e) {
    $('.groups-map__intro').toggleClass('collapsed');
  })
</script>

<!--  Places Libary for Autocomplete -->
<script src="//maps.googleapis.com/maps/api/js?key=AIzaSyC1wSXL1blzsn-B_8KJHc-b1QFrxVPyhBg&libraries=places&callback=initAutocomplete" async defer></script>

{% endblock %}
